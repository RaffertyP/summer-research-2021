"0","month_length = c(31,28,31,30,31,30,31,31,30,31,30,31)"
"0","weather_regions = list(""Auckland"" = ""Auckland"", ""Upper Hutt"" = ""Wellington"",""Christchurch"" = ""Christchurch"", ""Dunedin"" = ""Coastal Otago"", ""Hamilton"" = ""Waikato"", ""Rotorua"" = ""Bay of Plenty"",""Christchurch"" = ""Mid Canterbury"", ""Christchurch"" = ""North Canterbury"", ""Christchurch"" = ""South Canterbury"", ""Clyde"" = ""Central Otago"", ""Nelson"" = ""Nelson"", ""Auckland"" = ""Whangarei"", ""Auckland"" = ""Far North"", ""Upper Hutt"" = ""Wairarapa"", ""Auckland"" = ""Rodney"", ""Dunedin"" = ""Waitaki"", ""Nelson"" = ""Golden Bay"",  ""Auckland"" = ""Coromandel"", ""Palmerston North"" = ""Manawatu"")"
"0",""
"0",""
"0",""
"0","#main EV data"
"0","EV_data = read.csv('../Ftf Efficiency Dataset/ftf_ev_efficiency_distance_models_20211006_v1.0.csv', stringsAsFactors = T)[-1]"
"0","EV_data$weather_region = as.factor(names(weather_regions)[match(EV_data$region,  weather_regions)])"
"0",""
"0","#sort factor by popularity"
"0","region_pop = EV_data %>%"
"0","  group_by(weather_region) %>% "
"0","  summarise(count =  n_distinct(vehicle)) %>% "
"0","  arrange(-count)"
"0","model_pop = EV_data %>%"
"0","  group_by(model) %>% "
"0","  summarise(count =  n_distinct(vehicle)) %>% "
"0","  arrange(-count)"
"0","EV_data$weather_region = factor(EV_data$weather_region, levels = region_pop$weather_region)"
"0","EV_data$model = factor(EV_data$model, levels = model_pop$model)"
"0",""
"0","#remove PHEV"
"0","EV_data = EV_data[EV_data$model != ""Mitsubishi Outlander"" & EV_data$model != ""Toyota Prius"" & EV_data$model != ""Mini Countryman PHEV"", ]"
"0",""
"0",""
"0","#weather data"
"0","auckland_weather = read.csv('weather_data/auckland_motat_ews_data.csv',na.strings = ""-"",stringsAsFactors = T)"
"0","auckland_weather$Month = match(auckland_weather$Month, month.abb)"
"0","#Wellington does not have NIWA stations so closest is upperhutt"
"0","upperhutt_weather = read.csv('weather_data/upperhutt_trentham_ews_data.csv',na.strings = ""-"",stringsAsFactors = T)"
"0","upperhutt_weather$Month = match(upperhutt_weather$Month, month.abb)"
"0","christchurch_weather = read.csv('weather_data/christchurch_kyle_st_ews_data.csv',na.strings = ""-"", stringsAsFactors = T)"
"0","christchurch_weather$Month = match(christchurch_weather$Month, month.abb)"
"0","#use Dunedin weather for coastal Otago"
"0","dunedin_weather = read.csv('weather_data/dunedin_musselburgh_ews_data.csv',na.strings = ""-"",stringsAsFactors = T)"
"0","dunedin_weather$Month = match(dunedin_weather$Month, month.abb)"
"0","#use hamilton weather for Waikato"
"0","hamilton_weather = read.csv('weather_data/hamilton_ruakura_ews_data.csv', na.strings = ""-"", stringsAsFactors = T)"
"0","hamilton_weather$Month = match(hamilton_weather$Month, month.abb)"
"0","rotorua_weather = read.csv('weather_data/rotorua_ews_data.csv', na.strings = ""-"", stringsAsFactors = T)"
"0","rotorua_weather$Month = match(rotorua_weather$Month, month.abb)"
"0","#use clyde for central Otago"
"0","clyde_weather = read.csv('weather_data/clyde_ews_data.csv', na.strings = ""-"", stringsAsFactors = T)"
"0","clyde_weather$Month = match(clyde_weather$Month, month.abb)"
"0","nelson_weather = read.csv('weather_data/nelson_ews_data.csv', na.strings = ""-"", stringsAsFactors = T)"
"0","nelson_weather$Month = match(nelson_weather$Month, month.abb)"
"0","#use palmerston north for Manawatu"
"0","palmerston_weather = read.csv('weather_data/palmerston_north_ews_data.csv', na.strings = ""-"", stringsAsFactors = T)"
"0","palmerston_weather$Month = match(palmerston_weather$Month, month.abb)"
"0",""
"0","#temp calculations"
"0","HDD_data = Reduce(rbind, list(HDD(auckland_weather), HDD(upperhutt_weather), HDD(christchurch_weather),"
"0","                HDD(dunedin_weather), HDD(hamilton_weather), HDD(rotorua_weather), HDD(clyde_weather),"
"0","                HDD(nelson_weather), HDD(palmerston_weather)))"
"0","CDD_data = Reduce(rbind, list(CDD(auckland_weather), CDD(upperhutt_weather), CDD(christchurch_weather),"
"0","                CDD(dunedin_weather), CDD(hamilton_weather), CDD(rotorua_weather), CDD(clyde_weather),"
"0","                CDD(nelson_weather), CDD(palmerston_weather)))"
"0","avg_temp_data = Reduce(rbind, list(avg_temp(auckland_weather), avg_temp(upperhutt_weather), avg_temp(christchurch_weather),"
"0","                avg_temp(dunedin_weather), avg_temp(hamilton_weather), avg_temp(rotorua_weather), avg_temp(clyde_weather),"
"0","                avg_temp(nelson_weather), avg_temp(palmerston_weather)))"
"0",""
"0","EV_data = merge(EV_data, HDD_data, by.x = c(""year"", ""month"", ""weather_region""), by.y = c(""Year"", ""Month"", ""City""), all.x = T)"
"0","EV_data = merge(EV_data, CDD_data, by.x = c(""year"", ""month"", ""weather_region""), by.y = c(""Year"", ""Month"", ""City""), all.x = T)"
"0","EV_data = merge(EV_data, avg_temp_data, by.x = c(""year"", ""month"", ""weather_region""), by.y = c(""Year"", ""Month"", ""City""), all.x = T)"
"0",""
"0","attach(EV_data)"
"0",""
"0",""
"0",""
"0","#EV data with columns averaged by month"
"0","monthly_EV_data = EV_data[year >= 2017,] %>% "
"0","  group_by(year, month) %>% "
"0","  summarise(mean_kwh = mean(kwh), mean_dist = mean(distance), mean_ef = mean(efficiency))"
"0","monthly_EV_data$m = 1:nrow(monthly_EV_data)"
"0",""
"0","#EV data with columns averaged by month and weather region"
"0","monthly_reg_EV_data = EV_data[year >= 2017,] %>% "
"0","  na.omit() %>% "
"0","  group_by(year, month, weather_region) %>% "
"0","  summarise(mean_kwh = mean(kwh), mean_dist = mean(distance), mean_ef = mean(efficiency),"
"0","            HDD = mean(HDD), CDD = mean(CDD), avg_temp = mean(avg_temp))"
"0",""
"0",""
"0",""
"0","#card transactions at fuel stations"
"0","card_fuel = read.csv(""Downloaded stats/fuel_usage_card_transactions_data.csv"", header = T)"
"0",""
"0","#fuel cost data"
"0","fuel_cost = read.csv(""Downloaded stats/MBIE_weekly_fuel_cost.csv"")"
"0","fuel_cost$Week_ending_Friday = as.Date(fuel_cost$Week_ending_Friday)"
"0","fuel_cost$year = as.numeric(format(fuel_cost$Week_ending_Friday, '%Y'))"
"0","fuel_cost$month = as.numeric(format(fuel_cost$Week_ending_Friday, '%m'))"
"0","month_fuel_cost = fuel_cost %>% "
"0","  group_by(year, month) %>% "
"0","card_fuel = merge(card_fuel, month_fuel_cost, by = c(""year"", ""month""), sort = FALSE)"
"0","card_fuel = card_fuel[card_fuel$year != 2004,]"
"0","card_fuel_bl = card_fuel[card_fuel$year <= 2019,]"
"0","fuel_cost = NULL"
"0","month_fuel_cost = NULL"
"0",""
